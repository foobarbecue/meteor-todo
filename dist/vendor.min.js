var JSON;JSON||(JSON={}),function(){function str(t,e){var n,o,r,i,s,a=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(i=u.length,n=0;i>n;n+=1)s[n]=str(n,u)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)"string"==typeof rep[n]&&(o=rep[n],r=str(o,u),r&&s.push(quote(o)+(gap?": ":":")+r));else for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(r=str(o,u),r&&s.push(quote(o)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function f(t){return 10>t?"0"+t:t}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,n){var o;if(gap="",indent="","number"==typeof n)for(o=0;n>o;o+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,!e||"function"==typeof e||"object"==typeof e&&"number"==typeof e.length)return str("",{"":t});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var n,o,r=t[e];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(o=walk(r,n),void 0!==o?r[n]=o:delete r[n]);return reviver.call(t,e,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var t=document,e=window,n={},o=function(){};o.prototype.addEventListener=function(t,e){this._listeners||(this._listeners={}),t in this._listeners||(this._listeners[t]=[]);var o=this._listeners[t];-1===n.arrIndexOf(o,e)&&o.push(e)},o.prototype.removeEventListener=function(t,e){if(this._listeners&&t in this._listeners){var o=this._listeners[t],r=n.arrIndexOf(o,e);return-1!==r?void(o.length>1?this._listeners[t]=o.slice(0,r).concat(o.slice(r+1)):delete this._listeners[t]):void 0}},o.prototype.dispatchEvent=function(t){var e=t.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,n),this._listeners&&e in this._listeners)for(var o=0;o<this._listeners[e].length;o++)this._listeners[e][o].apply(this,n)};var r=function(t,e){if(this.type=t,"undefined"!=typeof e)for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n])};r.prototype.toString=function(){var t=[];for(var e in this)if(this.hasOwnProperty(e)){var n=this[e];"function"==typeof n&&(n="[function]"),t.push(e+"="+n)}return"SimpleEvent("+t.join(", ")+")"};var i=function(t){var e=this;e._events=t||[],e._listeners={}};i.prototype.emit=function(t){var e=this;if(e._verifyType(t),!e._nuked){var n=Array.prototype.slice.call(arguments,1);if(e["on"+t]&&e["on"+t].apply(e,n),t in e._listeners)for(var o=0;o<e._listeners[t].length;o++)e._listeners[t][o].apply(e,n)}},i.prototype.on=function(t,e){var n=this;n._verifyType(t),n._nuked||(t in n._listeners||(n._listeners[t]=[]),n._listeners[t].push(e))},i.prototype._verifyType=function(t){var e=this;-1===n.arrIndexOf(e._events,t)&&n.log("Event "+JSON.stringify(t)+" not listed "+JSON.stringify(e._events)+" in "+e)},i.prototype.nuke=function(){var t=this;t._nuked=!0;for(var e=0;e<t._events.length;e++)delete t[t._events[e]];t._listeners={}};var s="abcdefghijklmnopqrstuvwxyz0123456789_";n.random_string=function(t,e){e=e||s.length;var n,o=[];for(n=0;t>n;n++)o.push(s.substr(Math.floor(Math.random()*e),1));return o.join("")},n.random_number=function(t){return Math.floor(Math.random()*t)},n.random_number_string=function(t){var e=(""+(t-1)).length,o=Array(e+1).join("0");return(o+n.random_number(t)).slice(-e)},n.getOrigin=function(t){t+="/";var e=t.split("/").slice(0,3);return e.join("/")},n.isSameOriginUrl=function(t,n){return n||(n=e.location.href),t.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(t){if(/^[0-9.]*$/.test(t))return t;if(/^\[/.test(t))return t;if(!/[.]/.test(t))return t;var e=t.split(".").slice(1);return e.join(".")},n.objectExtend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t};var a="_jp";n.polluteGlobalNamespace=function(){a in e||(e[a]={})},n.closeFrame=function(t,e){return"c"+JSON.stringify([t,e])},n.userSetCode=function(t){return 1e3===t||t>=3e3&&4999>=t},n.countRTO=function(t){var e;return e=t>100?3*t:t+200},n.log=function(){e.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(t,e){return t.bind?t.bind(e):function(){return t.apply(e,arguments)}},n.flatUrl=function(t){return-1===t.indexOf("?")&&-1===t.indexOf("#")},n.amendUrl=function(e){var o=t.location;if(!e)throw new Error("Wrong url for SockJS");if(!n.flatUrl(e))throw new Error("Only basic urls are supported in SockJS");return 0===e.indexOf("//")&&(e=o.protocol+e),0===e.indexOf("/")&&(e=o.protocol+"//"+o.host+e),e=e.replace(/[/]+$/,"")},n.arrIndexOf=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},n.arrSkip=function(t,e){var o=n.arrIndexOf(t,e);if(-1===o)return t.slice();var r=t.slice(0,o);return r.concat(t.slice(o+1))},n.isArray=Array.isArray||function(t){return{}.toString.call(t).indexOf("Array")>=0},n.delay=function(t,e){return"function"==typeof t&&(e=t,t=0),setTimeout(e,t)};var u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f={"\x00":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","Â€":"\\u0080","Â":"\\u0081","Â‚":"\\u0082","Âƒ":"\\u0083","Â„":"\\u0084","Â…":"\\u0085","Â†":"\\u0086","Â‡":"\\u0087","Âˆ":"\\u0088","Â‰":"\\u0089","ÂŠ":"\\u008a","Â‹":"\\u008b","ÂŒ":"\\u008c","Â":"\\u008d","ÂŽ":"\\u008e","Â":"\\u008f","Â":"\\u0090","Â‘":"\\u0091","Â’":"\\u0092","Â“":"\\u0093","Â”":"\\u0094","Â•":"\\u0095","Â–":"\\u0096","Â—":"\\u0097","Â˜":"\\u0098","Â™":"\\u0099","Âš":"\\u009a","Â›":"\\u009b","Âœ":"\\u009c","Â":"\\u009d","Âž":"\\u009e","ÂŸ":"\\u009f","Â­":"\\u00ad","Ø€":"\\u0600","Ø":"\\u0601","Ø‚":"\\u0602","Øƒ":"\\u0603","Ø„":"\\u0604","Ü":"\\u070f","áž´":"\\u17b4","ážµ":"\\u17b5","â€Œ":"\\u200c","â€":"\\u200d","â€Ž":"\\u200e","â€":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","â€ª":"\\u202a","â€«":"\\u202b","â€¬":"\\u202c","â€­":"\\u202d","â€®":"\\u202e","â€¯":"\\u202f","â ":"\\u2060","â¡":"\\u2061","â¢":"\\u2062","â£":"\\u2063","â¤":"\\u2064","â¥":"\\u2065","â¦":"\\u2066","â§":"\\u2067","â¨":"\\u2068","â©":"\\u2069","âª":"\\u206a","â«":"\\u206b","â¬":"\\u206c","â­":"\\u206d","â®":"\\u206e","â¯":"\\u206f","ï»¿":"\\ufeff","ï¿°":"\\ufff0","ï¿±":"\\ufff1","ï¿²":"\\ufff2","ï¿³":"\\ufff3","ï¿´":"\\ufff4","ï¿µ":"\\ufff5","ï¿¶":"\\ufff6","ï¿·":"\\ufff7","ï¿¸":"\\ufff8","ï¿¹":"\\ufff9","ï¿º":"\\ufffa","ï¿»":"\\ufffb","ï¿¼":"\\ufffc","ï¿½":"\\ufffd","ï¿¾":"\\ufffe","ï¿¿":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(t){return c.lastIndex=0,c.test(t)&&(t=t.replace(c,function(t){return f[t]})),'"'+t+'"'},d=function(t){var e,n={},o=[];for(e=0;65536>e;e++)o.push(String.fromCharCode(e));return t.lastIndex=0,o.join("").replace(t,function(t){return n[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n};n.quote=function(t){var e=p(t);return l.lastIndex=0,l.test(e)?(u||(u=d(l)),e.replace(l,function(t){return u[t]})):e};var h=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];n.probeProtocols=function(){for(var t={},e=0;e<h.length;e++){var n=h[e];t[n]=O[n]&&O[n].enabled()}return t},n.detectProtocols=function(t,e,n){var o={},r=[];e||(e=h);for(var i=0;i<e.length;i++){var s=e[i];o[s]=t[s]}var a=function(t){var e=t.shift();o[e]?r.push(e):t.length>0&&a(t)};return n.websocket!==!1&&a(["websocket"]),o["xhr-streaming"]&&!n.null_origin?r.push("xhr-streaming"):!o["xdr-streaming"]||n.cookie_needed||n.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):r.push("xdr-streaming"),o["xhr-polling"]&&!n.null_origin?r.push("xhr-polling"):!o["xdr-polling"]||n.cookie_needed||n.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):r.push("xdr-polling"),r};var _="_sockjs_global";n.createHook=function(){var t="a"+n.random_string(8);if(!(_ in e)){var o={};e[_]=function(t){return t in o||(o[t]={id:t,del:function(){delete o[t]}}),o[t]}}return e[_](t)},n.attachMessage=function(t){n.attachEvent("message",t)},n.attachEvent=function(n,o){"undefined"!=typeof e.addEventListener?e.addEventListener(n,o,!1):(t.attachEvent("on"+n,o),e.attachEvent("on"+n,o))},n.detachMessage=function(t){n.detachEvent("message",t)},n.detachEvent=function(n,o){"undefined"!=typeof e.addEventListener?e.removeEventListener(n,o,!1):(t.detachEvent("on"+n,o),e.detachEvent("on"+n,o))};var v={},y=!1,m=function(){for(var t in v)v[t](),delete v[t]},g=function(){y||(y=!0,m())};n.attachEvent("unload",g),n.unload_add=function(t){var e=n.random_string(8);return v[e]=t,y&&n.delay(m),e},n.unload_del=function(t){t in v&&delete v[t]},n.createIframe=function(e,o){var r,i,s=t.createElement("iframe"),a=function(){clearTimeout(r);try{s.onload=null}catch(t){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),n.unload_del(i))},c=function(t){s&&(u(),o(t))},f=function(t,e){try{s&&s.contentWindow&&s.contentWindow.postMessage(t,e)}catch(n){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(r),r=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),r=setTimeout(function(){c("timeout")},15e3),i=n.unload_add(u),{post:f,cleanup:u,loaded:a}},n.createHtmlfile=function(t,o){var r,i,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(r)},f=function(){u&&(c(),n.unload_del(i),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(t){u&&(f(),o(t))},p=function(t,e){try{s&&s.contentWindow&&s.contentWindow.postMessage(t,e)}catch(n){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var d=u.createElement("div");return u.body.appendChild(d),s=u.createElement("iframe"),d.appendChild(s),s.src=t,r=setTimeout(function(){l("timeout")},15e3),i=n.unload_add(f),{post:p,cleanup:f,loaded:c}};var b=function(){};b.prototype=new i(["chunk","finish"]),b.prototype._start=function(t,o,r,i){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(o+=(-1===o.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=n.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,o,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(i&&i.no_credentials||(s.xhr.withCredentials="true"),i&&i.headers)for(var c in i.headers)s.xhr.setRequestHeader(c,i.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var t=s.xhr;switch(t.readyState){case 3:try{var e=t.status,n=t.responseText}catch(t){}1223===e&&(e=204),n&&n.length>0&&s.emit("chunk",e,n);break;case 4:var e=t.status;1223===e&&(e=204),s.emit("finish",e,t.responseText),s._cleanup(!1)}}},s.xhr.send(r)},b.prototype._cleanup=function(t){var e=this;if(e.xhr){if(n.unload_del(e.unload_ref),e.xhr.onreadystatechange=function(){},t)try{e.xhr.abort()}catch(o){}e.unload_ref=e.xhr=null}},b.prototype.close=function(){var t=this;t.nuke(),t._cleanup(!0)};var w=n.XHRCorsObject=function(){var t=this,e=arguments;n.delay(function(){t._start.apply(t,e)})};w.prototype=new b;var k=n.XHRLocalObject=function(t,e,o){var r=this;n.delay(function(){r._start(t,e,o,{no_credentials:!0})})};k.prototype=new b;var S=n.XDRObject=function(t,e,o){var r=this;n.delay(function(){r._start(t,e,o)})};S.prototype=new i(["chunk","finish"]),S.prototype._start=function(t,e,o){var r=this,i=new XDomainRequest;e+=(-1===e.indexOf("?")?"?":"&")+"t="+ +new Date;var s=i.ontimeout=i.onerror=function(){r.emit("finish",0,""),r._cleanup(!1)};i.onprogress=function(){r.emit("chunk",200,i.responseText)},i.onload=function(){r.emit("finish",200,i.responseText),r._cleanup(!1)},r.xdr=i,r.unload_ref=n.unload_add(function(){r._cleanup(!0)});try{r.xdr.open(t,e),r.xdr.send(o)}catch(a){s()}},S.prototype._cleanup=function(t){var e=this;if(e.xdr){if(n.unload_del(e.unload_ref),e.xdr.ontimeout=e.xdr.onerror=e.xdr.onprogress=e.xdr.onload=null,t)try{e.xdr.abort()}catch(o){}e.unload_ref=e.xdr=null}},S.prototype.close=function(){var t=this;t.nuke(),t._cleanup(!0)},n.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:P.enabled()?3:4};var O=function(t,o,r){if(this===e)return new O(t,o,r);var i,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},r&&n.objectExtend(s._options,r),s._base_url=n.amendUrl(t),s._server=s._options.server||n.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?i=s._options.protocols_whitelist:(i="string"==typeof o&&o.length>0?[o]:n.isArray(o)?o:null,i&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=O.CONNECTING,s._ir=Q(s._base_url),s._ir.onfinish=function(t,e){s._ir=null,t?(s._options.info&&(t=n.objectExtend(t,s._options.info)),s._options.rtt&&(e=s._options.rtt),s._applyInfo(t,e,i),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};O.prototype=new o,O.version="0.3.4",O.CONNECTING=0,O.OPEN=1,O.CLOSING=2,O.CLOSED=3,O.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},O.prototype._dispatchOpen=function(){var t=this;t.readyState===O.CONNECTING?(t._transport_tref&&(clearTimeout(t._transport_tref),t._transport_tref=null),t.readyState=O.OPEN,t.dispatchEvent(new r("open"))):t._didClose(1006,"Server lost session")},O.prototype._dispatchMessage=function(t){var e=this;e.readyState===O.OPEN&&e.dispatchEvent(new r("message",{data:t}))},O.prototype._dispatchHeartbeat=function(){var t=this;t.readyState===O.OPEN&&t.dispatchEvent(new r("heartbeat",{}))},O.prototype._didClose=function(t,e,o){var i=this;if(i.readyState!==O.CONNECTING&&i.readyState!==O.OPEN&&i.readyState!==O.CLOSING)throw new Error("INVALID_STATE_ERR");i._ir&&(i._ir.nuke(),i._ir=null),i._transport&&(i._transport.doCleanup(),i._transport=null);var s=new r("close",{code:t,reason:e,wasClean:n.userSetCode(t)});if(!n.userSetCode(t)&&i.readyState===O.CONNECTING&&!o){if(i._try_next_protocol(s))return;s=new r("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}i.readyState=O.CLOSED,n.delay(function(){i.dispatchEvent(s)})},O.prototype._didMessage=function(t){var e=this,n=t.slice(0,1);switch(n){case"o":e._dispatchOpen();break;case"a":for(var o=JSON.parse(t.slice(1)||"[]"),r=0;r<o.length;r++)e._dispatchMessage(o[r]);break;case"m":var o=JSON.parse(t.slice(1)||"null");e._dispatchMessage(o);break;case"c":var o=JSON.parse(t.slice(1)||"[]");e._didClose(o[0],o[1]);break;case"h":e._dispatchHeartbeat()}},O.prototype._try_next_protocol=function(e){var o=this;for(o.protocol&&(o._debug("Closed transport:",o.protocol,""+e),o.protocol=null),o._transport_tref&&(clearTimeout(o._transport_tref),o._transport_tref=null);;){var r=o.protocol=o._protocols.shift();if(!r)return!1;if(O[r]&&O[r].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return o._protocols.unshift(r),o.protocol="waiting-for-load",n.attachEvent("load",function(){o._try_next_protocol()}),!0;if(O[r]&&O[r].enabled(o._options)){var i=O[r].roundTrips||1,s=(o._options.rto||0)*i||5e3;o._transport_tref=n.delay(s,function(){o.readyState===O.CONNECTING&&o._didClose(2007,"Transport timeouted")});var a=n.random_string(8),u=o._base_url+"/"+o._server+"/"+a;return o._debug("Opening transport:",r," url:"+u," RTO:"+o._options.rto),o._transport=new O[r](o,u,o._base_url),!0}o._debug("Skipping transport:",r)}},O.prototype.close=function(t,e){var o=this;if(t&&!n.userSetCode(t))throw new Error("INVALID_ACCESS_ERR");return o.readyState!==O.CONNECTING&&o.readyState!==O.OPEN?!1:(o.readyState=O.CLOSING,o._didClose(t||1e3,e||"Normal closure"),!0)},O.prototype.send=function(t){var e=this;if(e.readyState===O.CONNECTING)throw new Error("INVALID_STATE_ERR");return e.readyState===O.OPEN&&e._transport.doSend(n.quote(""+t)),!0},O.prototype._applyInfo=function(e,o,r){var i=this;i._options.info=e,i._options.rtt=o,i._options.rto=n.countRTO(o),i._options.info.null_origin=!t.domain;var s=n.probeProtocols();i._protocols=n.detectProtocols(s,r,e)};var x=O.websocket=function(t,o){var r=this,i=o+"/websocket";i="https"===i.slice(0,5)?"wss"+i.slice(5):"ws"+i.slice(4),r.ri=t,r.url=i;var s=e.WebSocket||e.MozWebSocket;r.ws=new s(r.url),r.ws.onmessage=function(t){r.ri._didMessage(t.data)},r.unload_ref=n.unload_add(function(){r.ws.close()}),r.ws.onclose=function(){r.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(t){this.ws.send("["+t+"]")},x.prototype.doCleanup=function(){var t=this,e=t.ws;e&&(e.onmessage=e.onclose=null,e.close(),n.unload_del(t.unload_ref),t.unload_ref=t.ri=t.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var C=function(){};C.prototype.send_constructor=function(t){var e=this;e.send_buffer=[],e.sender=t},C.prototype.doSend=function(t){var e=this;e.send_buffer.push(t),e.send_stop||e.send_schedule()},C.prototype.send_schedule_wait=function(){var t,e=this;e.send_stop=function(){e.send_stop=null,clearTimeout(t)},t=n.delay(25,function(){e.send_stop=null,e.send_schedule()})},C.prototype.send_schedule=function(){var t=this;if(t.send_buffer.length>0){var e="["+t.send_buffer.join(",")+"]";t.send_stop=t.sender(t.trans_url,e,function(e,n){t.send_stop=null,e===!1?t.ri._didClose(1006,"Sending error "+n):t.send_schedule_wait()}),t.send_buffer=[]}},C.prototype.send_destructor=function(){var t=this;t._send_stop&&t._send_stop(),t._send_stop=null};var j=function(e,o,r){var i=this;if(!("_send_form"in i)){var s=i._send_form=t.createElement("form"),a=i._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=i._send_form,a=i._send_area,u="a"+n.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=o}catch(l){n.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var p=function(){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,n.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",r(!0))};return c.onerror=c.onload=p,c.onreadystatechange=function(){"complete"==c.readyState&&p()},p},E=function(t){return function(e,n,o){var r=new t("POST",e+"/xhr_send",n);return r.onfinish=function(t){o(200===t||204===t,"http status "+t)},function(t){o(!1,t)}}},N=function(e,o){var r,i,s=t.createElement("script"),a=function(t){i&&(i.parentNode.removeChild(i),i=null),s&&(clearTimeout(r),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,o(t),o=null)},u=!1,c=null;if(s.id="a"+n.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(){c||(c=setTimeout(function(){u||a(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(){a(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))i=t.createElement("script"),i.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=i.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),r=setTimeout(function(){a(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),i&&l.insertBefore(i,l.firstChild),a},T=O["jsonp-polling"]=function(t,e){n.polluteGlobalNamespace();var o=this;o.ri=t,o.trans_url=e,o.send_constructor(j),o._schedule_recv()};T.prototype=new C,T.prototype._schedule_recv=function(){var t=this,e=function(e){t._recv_stop=null,e&&(t._is_closing||t.ri._didMessage(e)),t._is_closing||t._schedule_recv()};t._recv_stop=R(t.trans_url+"/jsonp",N,e)},T.enabled=function(){return!0},T.need_body=!0,T.prototype.doCleanup=function(){var t=this;t._is_closing=!0,t._recv_stop&&t._recv_stop(),t.ri=t._recv_stop=null,t.send_destructor()};var R=function(t,o,r){var i="a"+n.random_string(6),s=t+"?c="+escape(a+"."+i),u=0,c=function(t){switch(u){case 0:delete e[a][i],r(t);break;case 1:r(t),u=2;break;case 2:delete e[a][i]}},f=o(s,c);e[a][i]=f;var l=function(){e[a][i]&&(u=1,e[a][i](n.closeFrame(1e3,"JSONP user aborted read")))};return l},I=function(){};I.prototype=new C,I.prototype.run=function(t,e,n,o,r){var i=this;i.ri=t,i.trans_url=e,i.send_constructor(E(r)),i.poll=new Y(t,o,e+n,r)},I.prototype.doCleanup=function(){var t=this;t.poll&&(t.poll.abort(),t.poll=null)};var J=O["xhr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",oe,n.XHRCorsObject)};J.prototype=new I,J.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},J.roundTrips=2,J.need_body=!0;var A=O["xdr-streaming"]=function(t,e){this.run(t,e,"/xhr_streaming",oe,n.XDRObject)};A.prototype=new I,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var L=O["xhr-polling"]=function(t,e){this.run(t,e,"/xhr",oe,n.XHRCorsObject)};L.prototype=new I,L.enabled=J.enabled,L.roundTrips=2;var M=O["xdr-polling"]=function(t,e){this.run(t,e,"/xhr",oe,n.XDRObject)};M.prototype=new I,M.enabled=A.enabled,M.roundTrips=2;var P=function(){};P.prototype.i_constructor=function(t,e,o){var r=this;r.ri=t,r.origin=n.getOrigin(o),r.base_url=o,r.trans_url=e;var i=o+"/iframe.html";r.ri._options.devel&&(i+="?t="+ +new Date),r.window_id=n.random_string(8),i+="#"+r.window_id,r.iframeObj=n.createIframe(i,function(t){r.ri._didClose(1006,"Unable to load an iframe ("+t+")")}),r.onmessage_cb=n.bind(r.onmessage,r),n.attachMessage(r.onmessage_cb)},P.prototype.doCleanup=function(){var t=this;if(t.iframeObj){n.detachMessage(t.onmessage_cb);try{t.iframeObj.iframe.contentWindow&&t.postMessage("c")}catch(e){}t.iframeObj.cleanup(),t.iframeObj=null,t.onmessage_cb=t.iframeObj=null}},P.prototype.onmessage=function(t){var e=this;if(t.origin===e.origin){var n=t.data.slice(0,8),o=t.data.slice(8,9),r=t.data.slice(9);if(n===e.window_id)switch(o){case"s":e.iframeObj.loaded(),e.postMessage("s",JSON.stringify([O.version,e.protocol,e.trans_url,e.base_url]));break;case"t":e.ri._didMessage(r)}}},P.prototype.postMessage=function(t,e){var n=this;n.iframeObj.post(n.window_id+t+(e||""),n.origin)},P.prototype.doSend=function(t){this.postMessage("m",t)},P.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var D,U=function(t,o){parent!==e?parent.postMessage(D+t+(o||""),"*"):n.log("Can't postMessage, no parent window.",t,o)},F=function(){};F.prototype._didClose=function(t,e){U("t",n.closeFrame(t,e))},F.prototype._didMessage=function(t){U("t",t)},F.prototype._doSend=function(t){this._transport.doSend(t)},F.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=void 0,O.bootstrap_iframe=function(){var o;D=t.location.hash.slice(1);var r=function(t){if(t.source===parent&&("undefined"==typeof n.parent_origin&&(n.parent_origin=t.origin),t.origin===n.parent_origin)){var r=t.data.slice(0,8),i=t.data.slice(8,9),s=t.data.slice(9);if(r===D)switch(i){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==O.version&&n.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+O.version+'".'),!n.flatUrl(f)||!n.flatUrl(l))return void n.log("Only basic urls are supported in SockJS");if(!n.isSameOriginUrl(f)||!n.isSameOriginUrl(l))return void n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");o=new F,o._transport=new F[c](o,f,l);break;case"m":o._doSend(s);break;case"c":o&&o._doCleanup(),o=null}}};n.attachMessage(r),U("s")};var X=function(t,e){var o=this;n.delay(function(){o.doXhr(t,e)})};X.prototype=new i(["finish"]),X.prototype.doXhr=function(t,e){var o=this,r=(new Date).getTime(),i=new e("GET",t+"/info"),s=n.delay(8e3,function(){i.ontimeout()});i.onfinish=function(t,e){if(clearTimeout(s),s=null,200===t){var n=(new Date).getTime()-r,i=JSON.parse(e);"object"!=typeof i&&(i={}),o.emit("finish",i,n)}else o.emit("finish")},i.ontimeout=function(){i.close(),o.emit("finish")}};var H=function(e){var o=this,r=function(){var t=new P;t.protocol="w-iframe-info-receiver";var n=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var n=JSON.parse(e.substr(1)),r=n[0],i=n[1];o.emit("finish",r,i)}else o.emit("finish");t.doCleanup(),t=null},r={_options:{},_didClose:n,_didMessage:n};t.i_constructor(r,e,e)};t.body?r():n.attachEvent("load",r)};H.prototype=new i(["finish"]);var q=function(){var t=this;n.delay(function(){t.emit("finish",{},2e3)})};q.prototype=new i(["finish"]);var Q=function(t){if(n.isSameOriginUrl(t))return new X(t,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new X(t,n.XHRLocalObject);case 2:return new X(t,n.XDRObject);case 3:return new H(t);default:return new q}},G=F["w-iframe-info-receiver"]=function(t,e,o){var r=new X(o,n.XHRLocalObject);r.onfinish=function(e,n){t._didMessage("m"+JSON.stringify([e,n])),t._didClose()}};G.prototype.doCleanup=function(){};var W=O["iframe-eventsource"]=function(){var t=this;t.protocol="w-iframe-eventsource",t.i_constructor.apply(t,arguments)};W.prototype=new P,W.enabled=function(){return"EventSource"in e&&P.enabled()},W.need_body=!0,W.roundTrips=3;var B=F["w-iframe-eventsource"]=function(t,e){this.run(t,e,"/eventsource",Z,n.XHRLocalObject)};B.prototype=new I;var $=O["iframe-xhr-polling"]=function(){var t=this;t.protocol="w-iframe-xhr-polling",t.i_constructor.apply(t,arguments)};$.prototype=new P,$.enabled=function(){return e.XMLHttpRequest&&P.enabled()},$.need_body=!0,$.roundTrips=3;var V=F["w-iframe-xhr-polling"]=function(t,e){this.run(t,e,"/xhr",oe,n.XHRLocalObject)};V.prototype=new I;var z=O["iframe-htmlfile"]=function(){var t=this;t.protocol="w-iframe-htmlfile",t.i_constructor.apply(t,arguments)};z.prototype=new P,z.enabled=function(){return P.enabled()},z.need_body=!0,z.roundTrips=3;var K=F["w-iframe-htmlfile"]=function(t,e){this.run(t,e,"/htmlfile",ne,n.XHRLocalObject)};K.prototype=new I;var Y=function(t,e,n,o){var r=this;r.ri=t,r.Receiver=e,r.recv_url=n,r.AjaxObject=o,r._scheduleRecv()};Y.prototype._scheduleRecv=function(){var t=this,e=t.poll=new t.Receiver(t.recv_url,t.AjaxObject),n=0;e.onmessage=function(e){n+=1,t.ri._didMessage(e.data)},e.onclose=function(n){t.poll=e=e.onmessage=e.onclose=null,t.poll_is_closing||("permanent"===n.reason?t.ri._didClose(1006,"Polling error ("+n.reason+")"):t._scheduleRecv())}},Y.prototype.abort=function(){var t=this;t.poll_is_closing=!0,t.poll&&t.poll.abort()};var Z=function(t){var e=this,o=new EventSource(t);o.onmessage=function(t){e.dispatchEvent(new r("message",{data:unescape(t.data)}))},e.es_close=o.onerror=function(t,i){var s=i?"user":2!==o.readyState?"network":"permanent";e.es_close=o.onmessage=o.onerror=null,o.close(),o=null,n.delay(200,function(){e.dispatchEvent(new r("close",{reason:s}))})}};Z.prototype=new o,Z.prototype.abort=function(){var t=this;t.es_close&&t.es_close({},!0)};var te,ee=function(){if(void 0===te)if("ActiveXObject"in e)try{te=!!new ActiveXObject("htmlfile")}catch(t){}else te=!1;return te},ne=function(t){var o=this;n.polluteGlobalNamespace(),o.id="a"+n.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+o.id);var i,s=ee()?n.createHtmlfile:n.createIframe;e[a][o.id]={start:function(){i.loaded()},message:function(t){o.dispatchEvent(new r("message",{data:t}))},stop:function(){o.iframe_close({},"network")}},o.iframe_close=function(t,n){i.cleanup(),o.iframe_close=i=null,delete e[a][o.id],o.dispatchEvent(new r("close",{reason:n}))},i=s(t,function(){o.iframe_close({},"permanent")})};ne.prototype=new o,ne.prototype.abort=function(){var t=this;t.iframe_close&&t.iframe_close({},"user")};var oe=function(t,e){var n=this,o=0;n.xo=new e("POST",t,null),n.xo.onchunk=function(t,e){if(200===t)for(;;){var i=e.slice(o),s=i.indexOf("\n");if(-1===s)break;o+=s+1;var a=i.slice(0,s);n.dispatchEvent(new r("message",{data:a}))}},n.xo.onfinish=function(t,e){n.xo.onchunk(t,e),n.xo=null;var o=200===t?"network":"permanent";n.dispatchEvent(new r("close",{reason:o}))}};return oe.prototype=new o,oe.prototype.abort=function(){var t=this;t.xo&&(t.xo.close(),t.dispatchEvent(new r("close",{reason:"user"})),t.xo=null)},O.getUtils=function(){return n},O.getIframeTransport=function(){return P},O}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS
}),function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){"use strict";function t(t){return function(){return B.apply(t,arguments)}}function e(t){return t===Object(t)}function n(t){return"[object StopIteration]"===ee(t)||t instanceof q}function o(t,e){if(F&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(ne)){for(var n=[],o=e;o;o=o.source)o.stack&&n.unshift(o.stack);n.unshift(t.stack);var i=n.join("\n"+ne+"\n");t.stack=r(i)}}function r(t){for(var e=t.split("\n"),n=[],o=0;o<e.length;++o){var r=e[o];a(r)||i(r)||!r||n.push(r)}return n.join("\n")}function i(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function s(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var o=/.*@(.+):(\d+)$/.exec(t);return o?[o[1],Number(o[2])]:void 0}function a(t){var e=s(t);if(!e)return!1;var n=e[0],o=e[1];return n===H&&o>=Q&&se>=o}function u(){if(F)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],o=s(n);if(!o)return;return H=o[0],o[1]}}function c(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function f(t){return y(t)?t:m(t)?j(t):C(t)}function l(){function t(t){e=t,i.source=t,V(n,function(e,n){W(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,o=void 0}var e,n=[],o=[],r=Y(l.prototype),i=Y(h.prototype);if(i.promiseDispatch=function(t,r,i){var s=$(arguments);n?(n.push(s),"when"===r&&i[1]&&o.push(i[1])):W(function(){e.promiseDispatch.apply(e,s)})},i.valueOf=function(){if(n)return i;var t=v(e);return y(t)&&(e=t),t},i.inspect=function(){return e?e.inspect():{state:"pending"}},f.longStackSupport&&F)try{throw new Error}catch(s){i.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return r.promise=i,r.resolve=function(n){e||t(f(n))},r.fulfill=function(n){e||t(C(n))},r.reject=function(n){e||t(x(n))},r.notify=function(t){e||V(o,function(e,n){W(function(){n(t)})},void 0)},r}function p(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=l();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function d(t){return p(function(e,n){for(var o=0,r=t.length;r>o;o++)f(t[o]).then(e,n)})}function h(t,e,n){void 0===e&&(e=function(t){return x(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var o=Y(h.prototype);if(o.promiseDispatch=function(n,r,i){var s;try{s=t[r]?t[r].apply(o,i):e.call(o,r,i)}catch(a){s=x(a)}n&&n(s)},o.inspect=n,n){var r=n();"rejected"===r.state&&(o.exception=r.reason),o.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?o:t.value}}return o}function _(t,e,n,o){return f(t).then(e,n,o)}function v(t){if(y(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function y(t){return e(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function m(t){return e(t)&&"function"==typeof t.then}function g(t){return y(t)&&"pending"===t.inspect().state}function b(t){return!y(t)||"fulfilled"===t.inspect().state}function w(t){return y(t)&&"rejected"===t.inspect().state}function k(){oe.length=0,re.length=0,ie||(ie=!0)}function S(t,e){ie&&(re.push(t),oe.push(e&&"undefined"!=typeof e.stack?e.stack:"(no stack) "+e))}function O(t){if(ie){var e=z(re,t);-1!==e&&(re.splice(e,1),oe.splice(e,1))}}function x(t){var e=h({when:function(e){return e&&O(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return S(e,t),e}function C(t){return h({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return te(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function j(t){var e=l();return W(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function E(t){return h({isDef:function(){}},function(e,n){return A(t,e,n)},function(){return f(t).inspect()})}function N(t,e,n){return f(t).spread(e,n)}function T(t){return function(){function e(t,e){var s;if("undefined"==typeof StopIteration){try{s=o[t](e)}catch(a){return x(a)}return s.done?s.value:_(s.value,r,i)}try{s=o[t](e)}catch(a){return n(a)?a.value:x(a)}return _(s,r,i)}var o=t.apply(this,arguments),r=e.bind(e,"next"),i=e.bind(e,"throw");return r()}}function R(t){f.done(f.async(t)())}function I(t){throw new q(t)}function J(t){return function(){return N([this,L(arguments)],function(e,n){return t.apply(e,n)})}}function A(t,e,n){return f(t).dispatch(e,n)}function L(t){return _(t,function(t){var e=0,n=l();return V(t,function(o,r,i){var s;y(r)&&"fulfilled"===(s=r.inspect()).state?t[i]=s.value:(++e,_(r,function(o){t[i]=o,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:i,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function M(t){return _(t,function(t){return t=K(t,f),_(L(K(t,function(t){return _(t,G,G)})),function(){return t})})}function P(t){return f(t).allSettled()}function D(t,e){return f(t).then(void 0,void 0,e)}function U(t,e){return f(t).nodeify(e)}var F=!1;try{throw new Error}catch(X){F=!!X.stack}var H,q,Q=u(),G=function(){},W=function(){function t(){for(;e.next;){e=e.next;var n=e.task;e.task=void 0;var r=e.domain;r&&(e.domain=void 0,r.enter());try{n()}catch(s){if(i)throw r&&r.exit(),setTimeout(t,0),r&&r.enter(),s;setTimeout(function(){throw s},0)}r&&r.exit()}o=!1}var e={task:void 0,next:null},n=e,o=!1,r=void 0,i=!1;if(W=function(t){n=n.next={task:t,domain:i&&process.domain,next:null},o||(o=!0,r())},"undefined"!=typeof process&&process.nextTick)i=!0,r=function(){process.nextTick(t)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){r=a,s.port1.onmessage=t,t()};var a=function(){s.port2.postMessage(0)};r=function(){setTimeout(t,0),a()}}else r=function(){setTimeout(t,0)};return W}(),B=Function.call,$=t(Array.prototype.slice),V=t(Array.prototype.reduce||function(t,e){var n=0,o=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=o)throw new TypeError}for(;o>n;n++)n in this&&(e=t(e,this[n],n));return e}),z=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),K=t(Array.prototype.map||function(t,e){var n=this,o=[];return V(n,function(r,i,s){o.push(t.call(e,i,s,n))},void 0),o}),Y=Object.create||function(t){function e(){}return e.prototype=t,new e},Z=t(Object.prototype.hasOwnProperty),te=Object.keys||function(t){var e=[];for(var n in t)Z(t,n)&&e.push(n);return e},ee=t(Object.prototype.toString);q="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var ne="From previous event:";f.resolve=f,f.nextTick=W,f.longStackSupport=!1,f.defer=l,l.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):t.resolve(arguments.length>2?$(arguments,1):n)}},f.Promise=p,f.promise=p,p.race=d,p.all=L,p.reject=x,p.resolve=f,f.passByCopy=function(t){return t},h.prototype.passByCopy=function(){return this},f.join=function(t,e){return f(t).join(e)},h.prototype.join=function(t){return f([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},f.race=d,h.prototype.race=function(){return this.then(f.race)},f.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(t,e,n){function r(e){try{return"function"==typeof t?t(e):e}catch(n){return x(n)}}function i(t){if("function"==typeof e){o(t,a);try{return e(t)}catch(n){return x(n)}}return x(t)}function s(t){return"function"==typeof n?n(t):t}var a=this,u=l(),c=!1;return W(function(){a.promiseDispatch(function(t){c||(c=!0,u.resolve(r(t)))},"when",[function(t){c||(c=!0,u.resolve(i(t)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=s(t)}catch(o){if(n=!0,!f.onerror)throw o;f.onerror(o)}n||u.notify(e)}]),u.promise},f.when=_,h.prototype.thenResolve=function(t){return this.then(function(){return t})},f.thenResolve=function(t,e){return f(t).thenResolve(e)},h.prototype.thenReject=function(t){return this.then(function(){throw t})},f.thenReject=function(t,e){return f(t).thenReject(e)},f.nearer=v,f.isPromise=y,f.isPromiseAlike=m,f.isPending=g,h.prototype.isPending=function(){return"pending"===this.inspect().state},f.isFulfilled=b,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},f.isRejected=w,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var oe=[],re=[],ie=!0;f.resetUnhandledRejections=k,f.getUnhandledReasons=function(){return oe.slice()},f.stopUnhandledRejectionTracking=function(){k(),ie=!1},k(),f.reject=x,f.fulfill=C,f.master=E,f.spread=N,h.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},f.async=T,f.spawn=R,f["return"]=I,f.promised=J,f.dispatch=A,h.prototype.dispatch=function(t,e){var n=this,o=l();return W(function(){n.promiseDispatch(o.resolve,t,e)}),o.promise},f.get=function(t,e){return f(t).dispatch("get",[e])},h.prototype.get=function(t){return this.dispatch("get",[t])},f.set=function(t,e,n){return f(t).dispatch("set",[e,n])},h.prototype.set=function(t,e){return this.dispatch("set",[t,e])},f.del=f["delete"]=function(t,e){return f(t).dispatch("delete",[e])},h.prototype.del=h.prototype["delete"]=function(t){return this.dispatch("delete",[t])},f.mapply=f.post=function(t,e,n){return f(t).dispatch("post",[e,n])},h.prototype.mapply=h.prototype.post=function(t,e){return this.dispatch("post",[t,e])},f.send=f.mcall=f.invoke=function(t,e){return f(t).dispatch("post",[e,$(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(t){return this.dispatch("post",[t,$(arguments,1)])},f.fapply=function(t,e){return f(t).dispatch("apply",[void 0,e])},h.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},f["try"]=f.fcall=function(t){return f(t).dispatch("apply",[void 0,$(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,$(arguments)])},f.fbind=function(t){var e=f(t),n=$(arguments,1);return function(){return e.dispatch("apply",[this,n.concat($(arguments))])}},h.prototype.fbind=function(){var t=this,e=$(arguments);return function(){return t.dispatch("apply",[this,e.concat($(arguments))])}},f.keys=function(t){return f(t).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},f.all=L,h.prototype.all=function(){return L(this)},f.allResolved=c(M,"allResolved","allSettled"),h.prototype.allResolved=function(){return M(this)},f.allSettled=P,h.prototype.allSettled=function(){return this.then(function(t){return L(K(t,function(t){function e(){return t.inspect()}return t=f(t),t.then(e,e)}))})},f.fail=f["catch"]=function(t,e){return f(t).then(void 0,e)},h.prototype.fail=h.prototype["catch"]=function(t){return this.then(void 0,t)},f.progress=D,h.prototype.progress=function(t){return this.then(void 0,void 0,t)},f.fin=f["finally"]=function(t,e){return f(t)["finally"](e)},h.prototype.fin=h.prototype["finally"]=function(t){return t=f(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},f.done=function(t,e,n,o){return f(t).done(e,n,o)},h.prototype.done=function(t,e,n){var r=function(t){W(function(){if(o(t,i),!f.onerror)throw t;f.onerror(t)})},i=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},f.timeout=function(t,e,n){return f(t).timeout(e,n)},h.prototype.timeout=function(t,e){var n=l(),o=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(o),n.resolve(t)},function(t){clearTimeout(o),n.reject(t)},n.notify),n.promise},f.delay=function(t,e){return void 0===e&&(e=t,t=void 0),f(t).delay(e)},h.prototype.delay=function(t){return this.then(function(e){var n=l();return setTimeout(function(){n.resolve(e)},t),n.promise})},f.nfapply=function(t,e){return f(t).nfapply(e)},h.prototype.nfapply=function(t){var e=l(),n=$(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},f.nfcall=function(t){var e=$(arguments,1);return f(t).nfapply(e)},h.prototype.nfcall=function(){var t=$(arguments),e=l();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},f.nfbind=f.denodeify=function(t){var e=$(arguments,1);return function(){var n=e.concat($(arguments)),o=l();return n.push(o.makeNodeResolver()),f(t).fapply(n).fail(o.reject),o.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var t=$(arguments);return t.unshift(this),f.denodeify.apply(void 0,t)},f.nbind=function(t,e){var n=$(arguments,2);return function(){function o(){return t.apply(e,arguments)}var r=n.concat($(arguments)),i=l();return r.push(i.makeNodeResolver()),f(o).fapply(r).fail(i.reject),i.promise}},h.prototype.nbind=function(){var t=$(arguments,0);return t.unshift(this),f.nbind.apply(void 0,t)},f.nmapply=f.npost=function(t,e,n){return f(t).npost(e,n)},h.prototype.nmapply=h.prototype.npost=function(t,e){var n=$(e||[]),o=l();return n.push(o.makeNodeResolver()),this.dispatch("post",[t,n]).fail(o.reject),o.promise},f.nsend=f.nmcall=f.ninvoke=function(t,e){var n=$(arguments,2),o=l();return n.push(o.makeNodeResolver()),f(t).dispatch("post",[e,n]).fail(o.reject),o.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(t){var e=$(arguments,1),n=l();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},f.nodeify=U,h.prototype.nodeify=function(t){return t?void this.then(function(e){W(function(){t(null,e)})},function(e){W(function(){t(e)})}):this};var se=u();return f}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.DDP=e()}(this,function(){"use strict";var t=function(){var t=0;return function(){return(t++).toString()}}(),e='{"server_id":"0"}',n=10,o=300,r=1e4,i=["added","changed","connected","error","failed","nosub","ready","removed","result","updated","ping","pong"],s=function(t){this._endpoint=t.endpoint,this._SocketConstructor=t.SocketConstructor,this._autoreconnect=!t.do_not_autoreconnect,this._ping_interval=t._ping_interval||r,this._socketInterceptFunction=t.socketInterceptFunction,this._onReadyCallbacks={},this._onStopCallbacks={},this._onErrorCallbacks={},this._onResultCallbacks={},this._onUpdatedCallbacks={},this._events={},this._queue=[],this.readyState=-1,this._reconnect_count=0,this._reconnect_incremental_timer=0,t.do_not_autoconnect||this.connect()};return s.prototype.constructor=s,s.prototype.connect=function(){this.readyState=0,this._socket=new this._SocketConstructor(this._endpoint),this._socket.onopen=this._on_socket_open.bind(this),this._socket.onmessage=this._on_socket_message.bind(this),this._socket.onerror=this._on_socket_error.bind(this),this._socket.onclose=this._on_socket_close.bind(this)},s.prototype.method=function(e,n,o,r){var i=t();return this._onResultCallbacks[i]=o,this._onUpdatedCallbacks[i]=r,this._send({msg:"method",id:i,method:e,params:n}),i},s.prototype.sub=function(e,n,o,r,i){var s=t();return this._onReadyCallbacks[s]=o,this._onStopCallbacks[s]=r,this._onErrorCallbacks[s]=i,this._send({msg:"sub",id:s,name:e,params:n}),s},s.prototype.unsub=function(t){return this._send({msg:"unsub",id:t}),t},s.prototype.on=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},s.prototype.off=function(t,e){if(this._events[t]){var n=this._events[t].indexOf(e);-1!==n&&this._events[t].splice(n,1)}},s.prototype._emit=function(t){if(this._events[t]){var e=arguments,n=this;this._events[t].forEach(function(t){t.apply(n,Array.prototype.slice.call(e,1))})}},s.prototype._send=function(t){if(1!==this.readyState&&"connect"!==t.msg)return void this._queue.push(t);var e;e="undefined"==typeof EJSON?JSON.stringify(t):EJSON.stringify(t),this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_message_sent",message:e,timestamp:Date.now()}),this._socket.send(e)},s.prototype._try_reconnect=function(){this._reconnect_count<n?(setTimeout(this.connect.bind(this),this._reconnect_incremental_timer),this._reconnect_count+=1,this._reconnect_incremental_timer+=o*this._reconnect_count):setTimeout(this.connect.bind(this),this._reconnect_incremental_timer)},s.prototype._on_result=function(t){if(this._onResultCallbacks[t.id])this._onResultCallbacks[t.id](t.error,t.result),delete this._onResultCallbacks[t.id],t.error&&delete this._onUpdatedCallbacks[t.id];else if(t.error)throw delete this._onUpdatedCallbacks[t.id],t.error},s.prototype._on_updated=function(t){var e=this;t.methods.forEach(function(t){e._onUpdatedCallbacks[t]&&(e._onUpdatedCallbacks[t](),delete e._onUpdatedCallbacks[t])})},s.prototype._on_nosub=function(t){if(t.error){if(!this._onErrorCallbacks[t.id])throw delete this._onReadyCallbacks[t.id],delete this._onStopCallbacks[t.id],new Error(t.error);return this._onErrorCallbacks[t.id](t.error),delete this._onReadyCallbacks[t.id],delete this._onStopCallbacks[t.id],void delete this._onErrorCallbacks[t.id]}this._onStopCallbacks[t.id]&&this._onStopCallbacks[t.id](),delete this._onReadyCallbacks[t.id],delete this._onStopCallbacks[t.id],delete this._onErrorCallbacks[t.id]},s.prototype._on_ready=function(t){var e=this;t.subs.forEach(function(t){e._onReadyCallbacks[t]&&(e._onReadyCallbacks[t](),delete e._onReadyCallbacks[t])})},s.prototype._on_error=function(t){this._emit("error",t)},s.prototype._on_connected=function(e){var n=this,o=0===n._reconnect_count,r=o?"connected":"reconnected";n.readyState=1,n._reconnect_count=0,n._reconnect_incremental_timer=0;for(var i=n._queue.length,s=0;i>s;s++)n._send(n._queue.shift());n._emit(r,e),n._ping_interval_handle=setInterval(function(){var e=t();n._send({msg:"ping",id:e})},n._ping_interval)},s.prototype._on_failed=function(t){this.readyState=4,this._emit("failed",t)},s.prototype._on_added=function(t){this._emit("added",t)},s.prototype._on_removed=function(t){this._emit("removed",t)},s.prototype._on_changed=function(t){this._emit("changed",t)},s.prototype._on_ping=function(t){this._send({msg:"pong",id:t.id})},s.prototype._on_pong=function(){},s.prototype._on_socket_close=function(){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_close",timestamp:Date.now()}),clearInterval(this._ping_interval_handle),this.readyState=4,this._emit("socket_close"),this._autoreconnect&&this._try_reconnect()},s.prototype._on_socket_error=function(t){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_error",error:JSON.stringify(t),timestamp:Date.now()}),clearInterval(this._ping_interval_handle),this.readyState=4,this._emit("socket_error",t)},s.prototype._on_socket_open=function(){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_open",timestamp:Date.now()}),this._send({msg:"connect",version:"pre2",support:["pre2"]})},s.prototype._on_socket_message=function(t){this._socketInterceptFunction&&this._socketInterceptFunction({type:"socket_message_received",message:t.data,timestamp:Date.now()});var n;if(t.data!==e){try{if(n="undefined"==typeof EJSON?JSON.parse(t.data):EJSON.parse(t.data),-1===i.indexOf(n.msg))throw new Error}catch(o){return console.warn("Non DDP message received:"),void console.warn(t.data)}this["_on_"+n.msg](n)}},s}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.Asteroid=e()}(this,function(){"use strict";function t(t){if("undefined"!=typeof EJSON)return EJSON.clone(t);var e=typeof t;switch(e){case"undefined":case"function":return void 0;case"string":case"number":case"boolean":return t;case"object":return null===t?null:JSON.parse(JSON.stringify(t));default:return}}function e(t){var e="";for(var n in t)e+=n+"="+t[n]+"&";return e=e.slice(0,-1)}function n(){for(var t="",e=0;8>e;e++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t}function o(t){return-1!==t.indexOf("@")}var r=function(){};r.prototype={constructor:r,on:function(t,e){this._events||(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events||(this._events={}),this._events[t]&&this._events[t].splice(this._events[t].indexOf(e),1)},_emit:function(t){if(this._events||(this._events={}),this._events[t]){var e=arguments,n=this;this._events[t].forEach(function(t){t.apply(n,Array.prototype.slice.call(e,1))})}}};var i={};i._toString=function(t){return Object.prototype.toString.call(t).slice(8,-1)},i.beString=function(t){var e=this._toString(t);if("String"!==e)throw new Error("Assertion failed: expected String, instead got "+e)},i.beArray=function(t){var e=this._toString(t);if("Array"!==e)throw new Error("Assertion failed: expected Array, instead got "+e)},i.beObject=function(t){var e=this._toString(t);if("Object"!==e)throw new Error("Assertion failed: expected Object, instead got "+e)};var s=function(t,e,n){i.beString(t),this._host=(e?"https://":"http://")+t,this._ddpOptions="function"==typeof SockJS?{endpoint:(e?"https://":"http://")+t+"/sockjs",SocketConstructor:SockJS,socketInterceptFunction:n}:{endpoint:(e?"wss://":"ws://")+t+"/websocket",SocketConstructor:WebSocket,socketInterceptFunction:n},this.collections={},this.subscriptions={},this._subscriptionsCache={},this._init()};s.prototype=Object.create(r.prototype),s.prototype.constructor=s,s.prototype._init=function(){var t=this;t.ddp=new DDP(this._ddpOptions),t.ddp.on("connected",function(){t.resumeLoginPromise=t._tryResumeLogin(),t.subscribe("meteor.loginServiceConfiguration"),t._emit("connected")}),t.ddp.on("reconnected",function(){t.resumeLoginPromise=t._tryResumeLogin(),t._reEstablishSubscriptions(),t._emit("reconnected")}),t.ddp.on("added",function(e){t._onAdded(e)}),t.ddp.on("changed",function(e){t._onChanged(e)}),t.ddp.on("removed",function(e){t._onRemoved(e)})},s.prototype._onAdded=function(t){var e=t.collection;this.collections[e]||(this.collections[e]=new s._Collection(e,this));var n=t.fields||{};n._id=t.id,this.collections[e]._remoteToLocalInsert(n)},s.prototype._onRemoved=function(t){this.collections[t.collection]&&this.collections[t.collection]._remoteToLocalRemove(t.id)},s.prototype._onChanged=function(t){this.collections[t.collection]&&(t.fields||(t.fields={}),t.cleared&&t.cleared.forEach(function(e){t.fields[e]=void 0}),this.collections[t.collection]._remoteToLocalUpdate(t.id,t.fields))},s.prototype.call=function(t){i.beString(t);var e=Array.prototype.slice.call(arguments,1);return this.apply(t,e)},s.prototype.apply=function(t,e){i.beString(t),Array.isArray(e)||(e=[]);var n=Q.defer(),o=Q.defer(),r=function(t,e){t?(n.reject(t),o.reject()):n.resolve(e)},s=function(){o.resolve()};return this.ddp.method(t,e,r,s),{result:n.promise,updated:o.promise}},s.prototype.getCollection=function(t){return i.beString(t),this.collections[t]||(this.collections[t]=new s._Collection(t,this)),this.collections[t]};var a="__del__",u="__upd__",c=function(t){var e=a.length,n=u.length,o=t.slice(-1*e),r=t.slice(-1*n);return o===a||r===u},f=function(t,e){this.name=t,this.asteroid=e,this._set=new d};f.prototype.constructor=f,f.prototype._localToLocalInsert=function(t){if(this._set.contains(t._id))throw new Error("Item "+t._id+" already exists");return this._set.put(t._id,t),Q(t._id)},f.prototype._remoteToLocalInsert=function(t){this._set.put(t._id,t)},f.prototype._localToRemoteInsert=function(t){var e=this,n=Q.defer(),o="/"+e.name+"/insert";return e.asteroid.ddp.method(o,[t],function(o){o?(e._set.del(t._id),n.reject(o)):n.resolve(t._id)}),n.promise},f.prototype.insert=function(t){return t._id||(t._id=n()),{local:this._localToLocalInsert(t),remote:this._localToRemoteInsert(t)}},f.prototype._localToLocalRemove=function(t){var e=this._set.get(t);return e&&(this._set.put(t+a,e),this._set.del(t)),Q(t)},f.prototype._remoteToLocalRemove=function(t){this._set.del(t)},f.prototype._localToRemoteRemove=function(t){var e=this,n=Q.defer(),o="/"+e.name+"/remove";return e.asteroid.ddp.method(o,[{_id:t}],function(o){if(o){var r=e._set.get(t+a);r&&(e._set.put(t,r),e._set.del(t+a)),n.reject(o)}else e._set.del(t+a),n.resolve(t)}),n.promise},f.prototype.remove=function(t){return{local:this._localToLocalRemove(t),remote:this._localToRemoteRemove(t)}},f.prototype._localToLocalUpdate=function(t,e){var n=this._set.get(t);if(!n)throw new Error("Item "+t+" doesn't exist");if(e._id&&e._id!==t)throw new Error("Modifying the _id of a document is not allowed");this._set.put(t+u,n);for(var o in e)n[o]=e[o];return this._set.put(t,n),Q(t)},f.prototype._remoteToLocalUpdate=function(t,e){var n=this._set.get(t);if(!n)return void console.warn("Server misbehaviour: item "+t+" doesn't exist");for(var o in e){if("_id"===o&&e._id!==t)return void console.warn("Server misbehaviour: modifying the _id of a document is not allowed");n[o]=e[o]}this._set.put(t,n)},f.prototype._localToRemoteUpdate=function(t,e){var n=this,o=Q.defer(),r="/"+n.name+"/update",i={_id:t},s={$set:e};return n.asteroid.ddp.method(r,[i,s],function(e){if(e){var r=n._set.get(t+u);n._set.put(t,r),n._set.del(t+u),o.reject(e)}else n._set.del(t+u),o.resolve(t)}),o.promise},f.prototype.update=function(t,e){return{local:this._localToLocalUpdate(t,e),remote:this._localToRemoteUpdate(t,e)}};var l=function(t){var e=this;e.result=[],e._set=t,e._getResult(),e._set.on("put",function(t){e._getResult(),e._emit("change",t)}),e._set.on("del",function(t){e._getResult(),e._emit("change",t)})};l.prototype=Object.create(r.prototype),l.constructor=l,l.prototype._getResult=function(){this.result=this._set.toArray()};var p=function(t){return function(e,n){if(c(e))return!1;var o=function(t,e){return e.split(".").reduce(function(t,e){return t?t=t[e]:t},t)};for(var r in t){var i=o(n,r);if(i!==t[r])return!1}return!0}};f.prototype.reactiveQuery=function(t){var e;e="function"==typeof t?t:p(t);var n=this._set.filter(e);return new l(n)},s._Collection=f,s.prototype._getOauthClientId=function(t){var e="meteor_accounts_loginServiceConfiguration",n=this.collections[e],o=n.reactiveQuery({service:t}).result[0];return o.clientId||o.consumerKey||o.appId},s.prototype._initOauthLogin=function(t,e,n){var o=window.open(n,"_blank","location=no,toolbar=no"),r=this;return Q().then(function(){var t=Q.defer();o.focus&&o.focus();var n=JSON.stringify({credentialToken:e}),i=setInterval(function(){o.postMessage(n,r._host)},100);return window.addEventListener("message",function(n){var o;try{o=JSON.parse(n.data)}catch(s){return}n.origin===r._host&&(o.credentialToken===e&&(clearInterval(i),t.resolve(o.credentialSecret)),o.error&&(clearInterval(i),t.reject(o.error)))}),t.promise}).then(function(t){var n=Q.defer(),o={oauth:{credentialToken:e,credentialSecret:t}};return r.ddp.method("login",[o],function(t,e){t?(delete r.userId,delete r.loggedIn,delete localStorage[r._host+"__login_token__"],n.reject(t),r._emit("loginError",t)):(r.userId=e.id,r.loggedIn=!0,localStorage[r._host+"__login_token__"]=e.token,r._emit("login",e.id),n.resolve(e.id))}),n.promise})},s.prototype._tryResumeLogin=function(){var t=this,e=Q.defer(),n=localStorage[t._host+"__login_token__"];if(!n)return e.reject("No login token"),e.promise;var o={resume:n};return t.ddp.method("login",[o],function(n,o){n?(delete t.userId,delete t.loggedIn,delete localStorage[t._host+"__login_token__"],t._emit("loginError",n),e.reject(n)):(t.userId=o.id,t.loggedIn=!0,localStorage[t._host+"__login_token__"]=o.token,t._emit("login",o.id),e.resolve(o.id))}),e.promise},s.prototype.loginWithFacebook=function(t){var o=n(),r={client_id:this._getOauthClientId("facebook"),redirect_uri:this._host+"/_oauth/facebook?close",state:o,scope:t||"email"},i="https://www.facebook.com/dialog/oauth?"+e(r);return this._initOauthLogin("facebook",o,i)},s.prototype.loginWithGoogle=function(t){var o=n(),r={response_type:"code",client_id:this._getOauthClientId("google"),redirect_uri:this._host+"/_oauth/google?close",state:o,scope:t||"openid email"},i="https://accounts.google.com/o/oauth2/auth?"+e(r);return this._initOauthLogin("google",o,i)},s.prototype.loginWithGithub=function(t){var o=n(),r={client_id:this._getOauthClientId("github"),redirect_uri:this._host+"/_oauth/github?close",state:o,scope:t||"email"},i="https://github.com/login/oauth/authorize?"+e(r);return this._initOauthLogin("github",o,i)},s.prototype.loginWithTwitter=function(){var t=n(),o=this._host+"/_oauth/twitter?close&state="+t,r={requestTokenAndRedirect:encodeURIComponent(o),state:t},i=this._host+"/_oauth/twitter/?"+e(r);return this._initOauthLogin("twitter",t,i)},s.prototype.createUser=function(t,e,n){var r=this,i=Q.defer(),s={username:o(t)?void 0:t,email:o(t)?t:void 0,password:e,profile:n};return r.ddp.method("createUser",[s],function(t,e){t?(r._emit("createUserError",t),i.reject(t)):(r.userId=e.id,r.loggedIn=!0,localStorage[r._host+"__login_token__"]=e.token,r._emit("createUser",e.id),r._emit("login",e.id),i.resolve(e.id))}),i.promise},s.prototype.loginWithPassword=function(t,e){var n=this,r=Q.defer(),i={password:e,user:{username:o(t)?void 0:t,email:o(t)?t:void 0}};return n.ddp.method("login",[i],function(t,e){t?(delete n.userId,delete n.loggedIn,delete localStorage[n._host+"__login_token__"],r.reject(t),n._emit("loginError",t)):(n.userId=e.id,n.loggedIn=!0,localStorage[n._host+"__login_token__"]=e.token,n._emit("login",e.id),r.resolve(e.id))}),r.promise},s.prototype.logout=function(){var t=this,e=Q.defer();return t.ddp.method("logout",[],function(n){n?(t._emit("logoutError",n),e.reject(n)):(delete t.userId,delete t.loggedIn,delete localStorage[t._host+"__login_token__"],t._emit("logout"),e.resolve())}),e.promise};var d=function(t){t&&(this._put=this.put,this._del=this.del,this.put=this.del=function(){throw new Error("Attempt to modify readonly set")}),this._items={}};d.prototype=Object.create(r.prototype),d.constructor=d,d.prototype.put=function(e,n){return i.beString(e),i.beObject(n),this._items[e]=t(n),this._emit("put",e),this},d.prototype.del=function(t){return i.beString(t),delete this._items[t],this._emit("del",t),this},d.prototype.get=function(e){return i.beString(e),t(this._items[e])},d.prototype.contains=function(t){return i.beString(t),!!this._items[t]},d.prototype.filter=function(e){var n=new d(!0),o=this._items,r=Object.keys(o);return r.forEach(function(r){var i=t(o[r]),s=e(r,i);s&&(n._items[r]=o[r])}),this.on("put",function(r){var i=t(o[r]),s=e(r,i);s&&n._put(r,o[r])}),this.on("del",function(t){n._del(t)}),n},d.prototype.toArray=function(){var e=[],n=this._items,o=Object.keys(this._items);return o.forEach(function(t){e.push(n[t])}),t(e)},d.prototype.toHash=function(){return t(this._items)},s.Set=d;var h=function(t,e,n){this._name=t,this._params=e,this._asteroid=n,this._ready=Q.defer(),this.ready=this._ready.promise;var o=this._onReady.bind(this),r=this._onStop.bind(this),i=this._onError.bind(this);this.id=n.ddp.sub(t,e,o,r,i)};return h.constructor=h,h.prototype.stop=function(){this._asteroid.ddp.unsub(this.id)},h.prototype._onReady=function(){this._ready.resolve(this.id)},h.prototype._onStop=function(){delete this._asteroid.subscriptions[this.id]},h.prototype._onError=function(t){this.ready.isPending()&&this._ready.reject(t),delete this._asteroid.subscriptions[this.id]},s.prototype.subscribe=function(t){i.beString(t);var e=JSON.stringify(arguments);if(!this._subscriptionsCache[e]){var n=Array.prototype.slice.call(arguments,1),o=new h(t,n,this);this._subscriptionsCache[e]=o,this.subscriptions[o.id]=o}return this._subscriptionsCache[e]
},s.prototype._reEstablishSubscriptions=function(){var t=this.subscriptions;for(var e in t)t.hasOwnProperty(e)&&(t[e]=new h(t[e]._name,t[e]._params,this))},s});